!function(e){function r(e,r){g.append('<li class="'+("success"==r?"text-light-green":"text-danger")+'">'+e+"</li>")}function s(){l=e("#importer-indicators .progress-bar"),c=e("#importer-indicators .progress-legend"),g=e("#importer-logger"),c.html(mwLang.collecting);var r={CUTOKEN_REQUEST:e("#cu-token").val(),action:"collect"};e.post("importer.php",r,function(e){if(!cuHandler.retrieveAjax(e))return c.addClass("text-danger").html(e.message),l.removeClass("progress-bar-info").removeClass("active").addClass("progress-bar-danger"),!1;if(e.categories.length<=0&&e.articles.length<=0)return c.addClass("text-warning").html(mwLang.noData),l.removeClass("progress-bar-info").removeClass("active").addClass("progress-bar-warning"),!1;i=e.articles,o=e.categories;var r=i.length+o.length;d=100/r;var s=e.categories.length;if(s>0)return l.removeClass("progress-bar-info").addClass("progress-bar-success"),void a(0);m=!0;var s=e.articles.length;return 0>=s?(c.addClass("text-warning").html(mwLang.noArticles),l.removeClass("progress-bar-info").removeClass("active").addClass("progress-bar-warning"),!1):void t(0)},"json")}function a(s){var n=o.length;if(s>n-1)return m=!0,c.html(mwLang.categoriesDone),l.css("width",d*n+"%"),t(0),!1;var i=o[s];c.html(mwLang.importingCategory.replace("%s",i.name)),p+=d,l.css("width",p+"%");var g={CUTOKEN_REQUEST:e("#cu-token").val(),action:"import-category",id:i.id};e.post("importer.php",g,function(e){return cuHandler.retrieveAjax(e)?(void 0!=e.result&&r(e.message,e.result),void a(s+1)):(c.addClass("text-danger").html(e.message),l.removeClass("progress-bar-info").removeClass("active").addClass("progress-bar-danger"),!1)},"json")}function t(s){var a=i.length;if(s>a-1)return c.html(mwLang.articlesDone),l.css("width","100%"),n(),!1;var o=i[s];c.html(mwLang.importingArticle.replace("%s",o.title)),p+=d,l.css("width",p+"%");var g={CUTOKEN_REQUEST:e("#cu-token").val(),action:"import-article",id:o.id};e.post("importer.php",g,function(e){return cuHandler.retrieveAjax(e)?(void 0!=e.result&&r(e.message,e.result),void t(s+1)):(c.addClass("text-danger").html(e.message),l.removeClass("progress-bar-info").removeClass("active").addClass("progress-bar-danger"),!1)},"json")}function n(){var r={CUTOKEN_REQUEST:e("#cu-token").val(),action:"close"};e.post("importer.php",r,function(r){g.fadeOut(250),e("#importer").fadeOut(250,function(){e("#importer-finished").fadeIn(250)})},"json")}var o,i,l,c,g,d,m=!1,p=0;e(document).ready(function(){e("#start-publisher").click(function(){e(this).cuSpinner().removeClass("btn-success").addClass("btn-default").disable(),e("#importer-logger").fadeIn(250),e("#importer-indicators").fadeIn(250,function(){s()})})})}(jQuery);
